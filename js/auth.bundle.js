(()=>{let e=localStorage.getItem("zalo_marketing_language")||"vi",t={};function n(){s()}function o(){chrome.identity.getAuthToken({interactive:!1},(function(e){chrome.runtime.lastError||!e?document.getElementById("loginBtn").innerHTML='<i class="fa fa-google" aria-hidden="true"></i> Đăng nhập bằng Google':fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:"Bearer "+e}}).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>{})).catch((e=>{console.error("Error fetching user info:",e)}))}))}function a(e,t){const n={accountNo:"0721000584901",accountName:"NGUYEN THAO",acqId:"970436",amount:e,addInfo:t,format:"text",template:"compact"};fetch("https://api.vietqr.io/v2/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((e=>e.json())).then((n=>{if("00"===n.code&&n.data&&n.data.qrDataURL){const o=document.getElementById("divQRCode");let a=e.toLocaleString("vi-VN");o.innerHTML=`\n                <h2 class="text-xl font-semibold mb-4 text-center">Quét mã QR để thanh toán</h2>\n                <div class="bg-blue-100 p-4 rounded-lg shadow-inner">\n                    <img src="${n.data.qrDataURL}" alt="QR Code for Payment" class="w-48 h-48 mx-auto"/>\n                </div>\n                <p class="mt-4 text-sm text-gray-600 text-center">\n                    Số tiền: <span style='color: red; font-weight: bold;'>${a}</span> VND<br>\n                    Nội dung: ${t}\n                </p>\n                <p class="mt-2 text-sm text-pink-600 font-semibold text-center">\n                    Cám ơn quý khách đã tin tưởng và sử dụng dịch vụ của chúng tôi!\n                </p>\n            `}else console.error("Error generating QR code:",n.desc)})).catch((e=>{console.error("Error:",e)}))}function r(){const e=document.getElementById("regPlan").value;var t=document.getElementById("regEmail").value;let n=0,o="";switch(e){case"6":n=0,o="Trial 1 Day";break;case"1":n=5e4,o=`Payment ${t}_1Month`;break;case"2":n=1e5,o=`Payment ${t}_3Months`;break;case"3":n=15e4,o=`Payment ${t}_6Months`;break;case"4":n=3e5,o=`Payment ${t}_12Months`;break;case"5":n=5e5,o=`Payment ${t}_Lifetime`;break;default:return void(document.getElementById("divQRCode").innerHTML="")}a(n,o)}function l(e){e=e.replace(/\s+/g,"").replace(/^(\+84)/,"0");return/^(03|05|07|08|09)\d{8}$/.test(e)}function i(){const t=document.getElementById("googleRegisterBtn"),n=document.getElementById("spanGoogle"),o="vi"===e,a=o?"Tiếp tục với Google":"Continue with Google";chrome.identity.getAuthToken({interactive:!0},(function(r){if(chrome.runtime.lastError||!r)return console.error("Error during Google sign in:",chrome.runtime.lastError),$.notify(o?"Đăng nhập thất bại: Không kết nối được Google":"Login failed: Unable to connect to Google","error"),n.textContent=a,t.disabled=!1,void t.classList.remove("opacity-50","cursor-not-allowed");fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:"Bearer "+r}}).then((e=>e.json())).then((e=>{const t=new URLSearchParams;return t.append("email",e.email),t.append("app_id",1),fetch("https://key.laptrinhvb.net/api/get_user_info",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t}).then((e=>e.json())).then((t=>({userCheckData:t,userInfo:e})))})).then((({userCheckData:i,userInfo:s})=>{if(null===i)return $.notify(o?"Vui lòng nhập số điện thoại để hoàn tất đăng ký.":"Please enter your phone number to complete registration.","info"),void function(t,n){const o=document.getElementById("phoneModal"),a=document.getElementById("btnSubmitPhone"),r=document.getElementById("btnCancelPhone"),i=document.getElementById("googlePhone");o.classList.remove("hidden"),i.value="",i.focus();const s=a.cloneNode(!0);a.parentNode.replaceChild(s,a);const c=r.cloneNode(!0);r.parentNode.replaceChild(c,r),c.addEventListener("click",(()=>{o.classList.add("hidden");const t=document.getElementById("googleRegisterBtn"),n=document.getElementById("spanGoogle"),a="vi"===e;n.textContent=a?"Tiếp tục với Google":"Continue with Google",t.disabled=!1,t.classList.remove("opacity-50","cursor-not-allowed")})),s.addEventListener("click",(()=>{const a=i.value.trim(),r="vi"===e;0!==a.length?l(a)?(o.classList.add("hidden"),function(t,n,o){const a="vi"===e,r=document.getElementById("googleRegisterBtn"),l=document.getElementById("spanGoogle"),i=a?"Tiếp tục với Google":"Continue with Google",s=new URLSearchParams({email:t.email,fullname:t.name,google_id:t.sub,avatar:t.picture,token:n,app_id:1,phone:o});fetch(`https://key.laptrinhvb.net/app/register_google?${s.toString()}`).then((e=>e.json())).then((e=>{if(e.status){$.notify(e.message,"success");const t=new Date;t.setDate(t.getDate()+1),"Registration successful via Google."===e.message&&(localStorage.setItem("rememberedEmail",e.email),localStorage.setItem("rememberedPassword",e.password),$("#loginEmail").val(e.email),$("#loginPassword").val(e.password)),chrome.storage.local.set({userEmail:e.email,loginExpiration:t.getTime()},(function(){chrome.storage.local.get(["tabZalo"],(function(e){const t=e.tabZalo?e.tabZalo.id:null;t?chrome.tabs.sendMessage(t,{task:"CHANGE_PAGE",page:"../page/popup.html"}):chrome.tabs.query({active:!0,currentWindow:!0},(function(e){e.length>0&&chrome.tabs.sendMessage(e[0].id,{task:"CHANGE_PAGE",page:"../page/popup.html"})}))}))}))}else $.notify((a?"Đăng nhập thất bại: ":"Login failed: ")+e.message,"error")})).catch((e=>{console.error("Error:",e),$.notify(a?"Đã xảy ra lỗi trong quá trình đăng nhập":"An error occurred during login","error")})).finally((()=>{l.textContent=i,r.disabled=!1,r.classList.remove("opacity-50","cursor-not-allowed")}))}(t,n,a)):$.notify(r?"Số điện thoại không hợp lệ. Vui lòng nhập đúng số điện thoại Việt Nam.":"Invalid phone number. Please enter a valid Vietnamese phone number.","error"):$.notify(r?"Vui lòng nhập số điện thoại.":"Please enter your phone number.","error")}))}(s,r);const c=new URLSearchParams({email:s.email,fullname:s.name,google_id:s.sub,avatar:s.picture,token:r,app_id:1});return fetch(`https://key.laptrinhvb.net/app/register_google?${c.toString()}`).then((e=>e.json())).then((e=>{if(e.status){$.notify("Login successful!","success");const t=new Date;t.setDate(t.getDate()+1),"Registration successful via Google."===e.message&&(localStorage.setItem("rememberedEmail",e.email),localStorage.setItem("rememberedPassword",e.password),$("#loginEmail").val(e.email),$("#loginPassword").val(e.password)),chrome.storage.local.set({userEmail:e.email||s.email,loginExpiration:t.getTime()},(function(){chrome.storage.local.get(["tabZalo"],(function(e){const t=e.tabZalo?e.tabZalo.id:null;t?chrome.tabs.sendMessage(t,{task:"CHANGE_PAGE",page:"../page/popup.html"}):chrome.tabs.query({active:!0,currentWindow:!0},(function(e){e.length>0&&chrome.tabs.sendMessage(e[0].id,{task:"CHANGE_PAGE",page:"../page/popup.html"})}))}))}))}else $.notify((o?"Đăng nhập thất bại: ":"Login failed: ")+e.message,"error"),n.textContent=a,t.disabled=!1,t.classList.remove("opacity-50","cursor-not-allowed")}))})).catch((e=>{console.error("Error:",e),$.notify(o?"Đã xảy ra lỗi khi xử lý đăng nhập":"Error processing login","error"),n.textContent=a,t.disabled=!1,t.classList.remove("opacity-50","cursor-not-allowed")}))}))}function s(){var t,n,o;(e=localStorage.getItem("zalo_marketing_language")||"vi","en"==e)?(document.getElementById("txtTitle").innerHTML="Sign In",document.getElementById("lblChuaCoTaiKhoan").innerHTML="Don't have an account?",document.getElementById("lblRemember").innerHTML="Remember me",document.getElementById("spanGoogle").innerHTML="Continue with Google",document.getElementById("loginButton").innerHTML="Sign In",document.getElementById("registerButton").innerHTML="Register",document.getElementById("txtTitleRegister").innerHTML="Register",document.getElementById("loginEmail").placeholder="Email",document.getElementById("loginPassword").placeholder="Password",document.getElementById("regEmail").placeholder="Email",document.getElementById("regPassword").placeholder="Password",document.getElementById("regPhone").placeholder="Phone Number",document.getElementById("regAddress").placeholder="Address",document.getElementById("regFullname").placeholder="Full Name",document.getElementById("lblContact").innerHTML="Contact us:",document.getElementById("lblAdmin").innerHTML="Admin Thao Nguyen",document.getElementById("showRegister").innerHTML=" Register",document.getElementById("showLogin").innerHTML=" Login",document.getElementById("txtDacotaikhoan").innerHTML=" Already have an account? ",(t=document.getElementById("regPlan")).innerHTML="",(n=document.createElement("option")).value="-1",n.textContent="-- Select License Plan --",t.appendChild(n),(o=document.createElement("option")).value="6",o.textContent="Trial - Free",t.appendChild(o),document.getElementById("modalTitle").textContent="Enter Phone Number",document.getElementById("modalDesc").textContent="Please enter the phone number you use for Zalo to register.",document.getElementById("googlePhone").placeholder="Phone Number",document.getElementById("btnSubmitPhone").textContent="Continue",document.getElementById("btnCancelPhone").textContent="Cancel"):(document.getElementById("txtTitle").innerHTML="Đăng nhập",document.getElementById("loginButton").innerHTML="Đăng nhập",document.getElementById("lblChuaCoTaiKhoan").innerHTML="Chưa có tài khoản?",document.getElementById("lblRemember").innerHTML="Ghi nhớ đăng nhập.",document.getElementById("spanGoogle").innerHTML="Đăng nhập với Google",document.getElementById("txtTitleRegister").innerHTML="Đăng ký",document.getElementById("txtDacotaikhoan").innerHTML=" Bạn đã có tài khoản? ",document.getElementById("registerButton").innerHTML="Đăng ký",document.getElementById("loginEmail").placeholder="Email",document.getElementById("loginPassword").placeholder="Mật khẩu",document.getElementById("regEmail").placeholder="Email",document.getElementById("regFullname").placeholder="Tên của bạn",document.getElementById("regPassword").placeholder="Mật khẩu",document.getElementById("regPhone").placeholder="Số điện thoại",document.getElementById("regAddress").placeholder="Địa chỉ",document.getElementById("lblContact").innerHTML="Liên hệ:",document.getElementById("lblAdmin").innerHTML="Admin Nguyễn Thảo",document.getElementById("showRegister").innerHTML=" Đăng ký",document.getElementById("showLogin").innerHTML=" Đăng nhập",(t=document.getElementById("regPlan")).innerHTML="",(n=document.createElement("option")).value="-1",n.textContent="-- Chọn gói cước --",t.appendChild(n),(o=document.createElement("option")).value="6",o.textContent="Dùng thử - Miễn phí",t.appendChild(o),document.getElementById("modalTitle").textContent="Nhập số điện thoại",document.getElementById("modalDesc").textContent="Vui lòng nhập số điện thoại đang sử dụng Zalo để đăng ký.",document.getElementById("googlePhone").placeholder="Số điện thoại",document.getElementById("btnSubmitPhone").textContent="Tiếp tục",document.getElementById("btnCancelPhone").textContent="Hủy")}document.addEventListener("DOMContentLoaded",(()=>{!async function(){try{const e=await fetch(chrome.runtime.getURL("../locales/locales.json"));t=await e.json(),n()}catch(e){console.error("Error loading translations:",e)}}();const o=document.querySelector(".language-switcher");if(o){const r=document.createElement("style");r.textContent="\n      .language-switcher img {\n        width: 24px;\n        height: 16px;\n        cursor: pointer;\n        border: 1px solid #ddd;\n        transition: all 0.2s;\n        filter: grayscale(70%) opacity(0.5); /* Làm mờ tất cả các lá cờ */\n      }\n\n      .language-switcher img.active {\n        filter: grayscale(0%) opacity(1); /* Hiển thị bình thường cho lá cờ active */\n        transform: scale(1.1); /* Làm nổi bật thêm lá cờ đang được chọn */\n        box-shadow: 0 0 3px rgba(255,255,255,0.5);\n      }\n\n      .language-switcher img:hover {\n        transform: scale(1.1);\n        filter: grayscale(0%) opacity(0.9); /* Khi hover, luôn hiển thị rõ ràng */\n      }\n      \n      /* Styling cho văn bản ngôn ngữ */\n      .language-switcher span {\n        color: #aaa;\n        font-size: 12px;\n        transition: all 0.2s;\n        margin: 0 2px;\n        cursor: pointer; /* Thêm cursor pointer khi hover */\n      }\n      \n      .language-switcher span.active {\n        color: white; /* Màu xanh lá */\n        font-weight: bold;\n      }\n      \n      .language-switcher span:hover {\n        color: #ddd; /* Màu sáng hơn khi hover */\n      }\n    ",document.head.appendChild(r);const l=new Map([["VIE","vi"],["ENG","en"]]);function a(){document.querySelectorAll(".language-switcher img, .language-switcher span").forEach((t=>{t.classList.toggle("active",t.dataset.lang===e)}))}document.querySelectorAll(".language-switcher span").forEach((e=>{const t=l.get(e.textContent.trim());t&&e.setAttribute("data-lang",t)})),a(),o.addEventListener("click",(t=>{if("IMG"===t.target.tagName||"SPAN"===t.target.tagName){const o=t.target.dataset.lang;o&&o!==e&&(e=o,localStorage.setItem("zalo_marketing_language",o),a(),n())}}))}})),o(),document.addEventListener("DOMContentLoaded",(function(){a(5e4,"TT 1 Thang");var e=document.getElementsByTagName("checkbox");document.getElementById("regPlan").addEventListener("change",r),chrome.storage.sync.get(["running"],(function({running:t}){let n=t+""!="false";o(n),function(t){t?(document.body.classList.add("dark-mode"),document.documentElement.classList.add("dark"),document.body.classList.add("dark"),e&&e.length>0&&(e.checked=!0)):(document.body.classList.remove("dark-mode"),document.documentElement.classList.remove("dark"),document.body.classList.remove("dark"),e&&e.length>0&&(e.checked=!1))}(n)}));const t=document.getElementById("sunIcon"),n=document.getElementById("moonIcon");function o(e){t.style.display=e?"block":"none",n.style.display=e?"none":"block"}document.getElementById("themeToggle").addEventListener("click",(function(){const e=document.body;e.classList.toggle("dark-mode"),e.classList.toggle("dark"),document.documentElement.classList.toggle("dark");const t=e.classList.contains("dark-mode");localStorage.setItem("darkMode",t),o(t),chrome.storage.sync.set({running:t},((...e)=>{}))}))})),document.addEventListener("DOMContentLoaded",(function(){const t=document.getElementById("registerForm"),n=document.getElementById("loginForm"),o=document.getElementById("showLogin"),a=document.getElementById("showRegister"),r=document.getElementById("registerButton"),i=document.getElementById("loginButton");function s(e,t){e.classList.add("border-red-500");const n=document.createElement("p");n.innerHTML=t,n.className="text-red-500 text-xs mt-1",e.parentNode.insertBefore(n,e.nextSibling)}function c(){document.querySelectorAll(".text-red-500").forEach((e=>e.remove())),document.querySelectorAll(".border-red-500").forEach((e=>e.classList.remove("border-red-500")))}function d(e,t){e.classList.remove("hidden"),t.classList.add("hidden")}document.getElementById("loginEmail").focus(),function(){const e=localStorage.getItem("rememberedEmail"),t=localStorage.getItem("rememberedPassword");e&&t&&(document.getElementById("loginEmail").value=e,document.getElementById("loginPassword").value=t,document.getElementById("rememberMe").checked=!0)}(),setTimeout((()=>{chrome.storage.local.get(["userEmail","loginExpiration"],(function(e){e.userEmail&&e.loginExpiration&&((new Date).getTime()<e.loginExpiration?chrome.storage.local.get(["tabZalo"],(function(e){const t=e.tabZalo.id;chrome.tabs.sendMessage(t,{task:"CHANGE_PAGE",page:"../page/popup.html"})})):(chrome.storage.local.remove(["userEmail","loginExpiration"]),chrome.storage.local.get(["tabZalo"],(function(e){const t=e.tabZalo.id;chrome.tabs.sendMessage(t,{task:"CHANGE_PAGE",page:"../page/login.html"})}))))}))}),2e3),o.addEventListener("click",(e=>{e.preventDefault(),d(n,t),$("#loginEmail").focus()})),a.addEventListener("click",(e=>{e.preventDefault(),d(t,n),$("#regEmail").focus()})),r.addEventListener("click",(function(){c();const o=document.getElementById("regEmail").value,a=document.getElementById("regPassword").value,r=document.getElementById("regPhone").value,i=document.getElementById("regAddress").value;document.getElementById("regPlan").value;const s=document.getElementById("regFullname").value;function m(t,n,o){const a="vi"===e?n:o;$(t).notify(a,"error")}if(0===o.length)return void m("#regEmail","Vui lòng nhập email.","Please enter your email.");if(!function(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}(o))return void m("#regEmail","Email không đúng định dạng.","Invalid email format.");if(a.length<5)return void m("#regPassword","Mật khẩu phải có ít nhất 5 ký tự.","Password must be at least 5 characters.");if(0===s.length)return void m("#regFullname","Vui lòng nhập họ tên.","Please enter your name.");if(0===r.length)return void m("#regPhone","Vui lòng nhập số điện thoại.","Please enter your phone number.");if(!l(r))return void m("#regPhone","Số điện thoại không hợp lệ. Vui lòng nhập đúng số điện thoại Việt Nam.","Invalid phone number. Please enter a valid Vietnamese phone number.");if(0===i.length)return void m("#regAddress","Vui lòng nhập địa chỉ.","Please enter your address.");const g=new URLSearchParams;g.append("email",o),g.append("password",a),g.append("phone",r),g.append("address",i),g.append("plan",6),g.append("fullname",s),g.append("app_id",1);const u=new URLSearchParams({email:o,password:a,app_id:1,phone:r,address:i,plan:6,fullname:s});fetch(`https://key.laptrinhvb.net/api/register_new?${u.toString()}`,{method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((e=>e.json())).then((e=>{e.status?($.notify(e.message,"success"),d(n,t),$("#loginContainer").css("width","380px"),$("#loginEmail").focus(),$("#loginEmail").val(o),$("#loginPassword").val(a),function(){for(var e=document.getElementById("registerForm"),t=e.getElementsByTagName("input"),n=0;n<t.length;n++)switch(t[n].type){case"text":case"password":case"email":case"number":case"date":case"tel":t[n].value="";break;case"checkbox":case"radio":t[n].checked=!1}var o=e.getElementsByTagName("select");for(n=0;n<o.length;n++)o[n].selectedIndex=0;var a=e.getElementsByTagName("textarea");for(n=0;n<a.length;n++)a[n].value=""}()):$.notify("Đăng ký thất bại: "+e.message,"error")})).catch((e=>{console.error("Error:",e),$.notify("Có lỗi xảy ra khi đăng ký","error")}))})),$(document).on("keypress",(function(e){13==e.which&&(e.preventDefault(),i.click())})),i.addEventListener("click",(function(){c();const t=document.getElementById("loginEmail"),n=document.getElementById("loginPassword");let o=!0;return t.value?n.value?(i.disabled=!0,i.innerHTML=`\n            <svg xmlns="http://www.w3.org/2000/svg" class="animate-spin h-5 w-5 inline-block mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">\n                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>\n                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 118 8V12H4z"></path>\n            </svg>\n            ${"en"===e?"Authenticating...":"Đang xác thực..."}\n        `,void setTimeout((()=>{if(o){const o=new URLSearchParams({email:t.value,password:n.value,app_id:1}).toString();fetch(`https://key.laptrinhvb.net/api/auth_new?${o}`,{method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded"},redirect:"manual"}).then((e=>{if("opaqueredirect"===e.type)throw new Error("Redirect detected");return e.ok?e.json():e.json().then((e=>{throw new Error(e.message||"An error occurred")}))})).then((e=>{if(e.status){!function(){const e=document.getElementById("loginEmail").value,t=document.getElementById("loginPassword").value;document.getElementById("rememberMe").checked?(localStorage.setItem("rememberedEmail",e),localStorage.setItem("rememberedPassword",t)):(localStorage.removeItem("rememberedEmail"),localStorage.removeItem("rememberedPassword"))}();const e=new Date;e.setDate(e.getDate()+1),chrome.storage.local.set({userEmail:t.value,loginExpiration:e.getTime()},(function(){chrome.tabs.query({active:!0,currentWindow:!0},(function(e){if(e.length>0){const t=e[0].id;chrome.tabs.sendMessage(t,{task:"CHANGE_PAGE",page:"../page/popup.html"})}}))}))}else s(t,e.message)})).catch((e=>{console.error("Fetch error:",e),s(t,"An error occurred. Please try again.")})),i.disabled=!1,i.innerHTML=""+("en"===e?"Sign In":"Đăng nhập")}}),1500)):(s(n,"Password is required"),void(o=!1)):(s(t,"Email is required"),void(o=!1))}))})),document.addEventListener("DOMContentLoaded",(function(){s();const e=document.getElementById("googleRegisterBtn");e&&e.addEventListener("click",i),document.getElementById("togglePassword").addEventListener("click",(function(){const e=document.getElementById("loginPassword"),t=this.querySelector("i");"password"===e.type?(e.type="text",t.classList.remove("fa-eye-slash"),t.classList.add("fa-eye")):(e.type="password",t.classList.remove("fa-eye"),t.classList.add("fa-eye-slash"))}))}))})();